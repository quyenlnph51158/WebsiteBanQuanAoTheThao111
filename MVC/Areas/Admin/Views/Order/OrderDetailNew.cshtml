@model API.Domain.DTOs.OrderDto
@using DAL_Empty.Models
@{
    ViewData["Title"] = "Chi tiết đơn hàng";
}

<style>
    @@media print {
        .no-print {
            display: none !important;
        }

        body {
            background: white !important;
        }

        .card {
            border: none;
            box-shadow: none;
        }
    }
</style>

<div class="container mt-4">
    <div class="no-print">
        <h2 class="mb-4 text-primary fw-bold">Chi tiết đơn hàng</h2>
    </div>

    <div class="card">
        <div class="card-header no-print">
            Thông tin chi tiết đơn hàng
        </div>
        <div class="card-body">
            <dl class="row">
                <dt class="col-sm-3">ID</dt>
                <dd class="col-sm-9">@Model.Id</dd>

                <dt class="col-sm-3">Ngày tạo</dt>
                <dd class="col-sm-9">@Model.CreateAt?.ToString("dd/MM/yyyy HH:mm")</dd>

                <dt class="col-sm-3">Người tạo</dt>
                <dd class="col-sm-9">@Model.CreateByName</dd>

                <dt class="col-sm-3">Ngày cập nhật</dt>
                <dd class="col-sm-9">@Model.UpdateAt?.ToString("dd/MM/yyyy HH:mm")</dd>

                <dt class="col-sm-3">Người cập nhật</dt>
                <dd class="col-sm-9">@Model.UpdateByName</dd>

                <dt class="col-sm-3">Khách hàng</dt>
                <dd class="col-sm-9">@Model.CustomerName</dd>

                <dt class="col-sm-3">Số điện thoại</dt>
                <dd class="col-sm-9">@Model.PhoneNumber</dd>

                <dt class="col-sm-3">Địa chỉ</dt>
                <dd class="col-sm-9">@Model.Address</dd>

                <dt class="col-sm-3">Phí vận chuyển</dt>
                <dd class="col-sm-9">@String.Format("{0:N0} VND", Model.ShippingFee ?? 0)</dd>

                <dt class="col-sm-3">Tổng tiền</dt>
                <dd class="col-sm-9 fw-bold text-danger">@String.Format("{0:N0} VND", Model.TotalAmount ?? 0)</dd>

                <dt class="col-sm-3">Trạng thái</dt>
                <dd class="col-sm-9">
                    <span class="badge
                        @(Model.Status == OrderStatus.Confirmed ? "bg-success" :
                                                    Model.Status == OrderStatus.Pending ? "bg-warning text-dark" :
                                                    Model.Status == OrderStatus.Cancelled ? "bg-danger" : "bg-secondary")">
                        @Model.Status
                    </span>
                </dd>

                @* Chỉ hiển thị lý do hủy nếu trạng thái Cancelled *@
                @if (Model.Status == OrderStatus.Cancelled && ViewBag.CancelReason != null)
                {
                    <dt class="col-sm-3">Lý do hủy</dt>
                    <dd class="col-sm-9 text-danger fw-bold">@ViewBag.CancelReason</dd>
                }

                <dt class="col-sm-3">Ghi chú</dt>
                <dd class="col-sm-9">@Model.Description</dd>

                @if (!string.IsNullOrEmpty(Model.Qrcode))
                {
                    <dt class="col-sm-3">Mã QR thanh toán</dt>
                    <dd class="col-sm-9">
                        <img src="data:image/png;base64,@Model.Qrcode" alt="QR Code" style="height:150px;" />
                    </dd>
                }
            </dl>

            <hr />

            <h5>Sản phẩm trong đơn</h5>
            <table class="table table-bordered">
                <thead class="table-light">
                    <tr>
                        <th>Tên sản phẩm</th>
                        <th>Số lượng</th>
                        <th>Giá</th>
                        <th>Thành tiền</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model.OrderDetails?.Any() ?? false)
                    {
                        foreach (var item in Model.OrderDetails)
                        {
                            <tr>
                                <td>@item.ProductName</td>
                                <td>@item.Quantity</td>
                                <td>@String.Format("{0:N0} VND", item.Price ?? 0)</td>
                                <td>@String.Format("{0:N0} VND", (item.Price ?? 0) * (item.Quantity ?? 0))</td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="4" class="text-center text-muted">Không có sản phẩm</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <div class="card-footer text-end no-print">
            <a asp-action="Index" class="btn btn-secondary">Hóa đơn</a>
            <a asp-action="Details" asp-route-id="@Model.Id" asp-route-print="true" target="_blank" class="btn btn-primary">
                In hóa đơn
            </a>
        </div>
    </div>
</div>
